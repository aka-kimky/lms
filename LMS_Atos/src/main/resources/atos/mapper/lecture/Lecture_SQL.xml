<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="atos.lms.lecture.service.dao.LectureDAO">


	<sql id="whereClause">
		<trim prefix="WHERE" prefixOverrides="AND">
			<if test="srcMainCode != null and srcMainCode !=''">
				AND CD.MAIN_CODE = #{srcMainCode}
			</if>
			
		    <if test="srcStartDate != null and srcStartDate != ''">
		        <![CDATA[
		        AND L.REC_START_DATE >= #{srcStartDate}
		        ]]>
		    </if>
		    <if test="srcEndDate != null and srcEndDate != ''">
		        <![CDATA[
		        AND L.REC_END_DATE <= #{srcEndDate}
		        ]]>
		    </if>
		    
		    <if test="srcLearnDate != null and srcLearnDate !=''">
		    	AND L.LEARN_DATE = #{srcLearnDate}
		    </if>
		
			<if test="searchCnd != null and searchCnd != ''">
				<if test="searchCnd == 0">
					AND I.NAME LIKE CONCAT ('%', #{searchWrd},'%') 		
				</if>
				<if test="searchCnd == 1">
					AND E.TITLE LIKE CONCAT ('%', #{searchWrd},'%') 		
				</if>
			</if>
		</trim>
	</sql>
	
	<select id="selectLectureList" resultType="atos.lms.lecture.service.LectureVO">
		SELECT
		    L.LECTURE_CODE, L.EDUCATION, L.INSTRUCTOR, L.LOCATION, L.ATCH_FILE_ID,          
		    L.REC_START_DATE, L.REC_END_DATE, L.STATUS, L.LEARN_DATE, L.START_TIME,            
		    L.END_TIME, L.MANAGER, L.MANAGER_CONTACT, L.LECTURE_METHOD, L.CAPACITY,              
		    L.ENROLLED, L.REG_DATE, L.REGISTER,              
		    E.TITLE, E.CATEGORY, E.DESCRIPTION, E.OBJECTIVE,             
		    E.COMPLETION_CRITERIA, E.NOTE, E.TRAINING_TIME,         
		    CD.USE_YN, CM.MAIN_CODE, CM.MAIN_NAME,            
		    CS.SUB_NAME, CS.SUB_CODE,
		    I.NAME AS instructorName              
		FROM ATOS_LECTURE L
		INNER JOIN ATOS_EDUCATION E 
			ON L.EDUCATION = E.EDU_CODE
		INNER JOIN ATOS_INSTRUCTOR I
	   		ON L.INSTRUCTOR = I.ID 
		INNER JOIN ATOS_CATEGORY_DETAIL CD 
			ON E.CATEGORY = CD.CODE
		INNER JOIN ATOS_CATEGORY_MAIN CM 
			ON CD.MAIN_CODE = CM.MAIN_CODE
		INNER JOIN ATOS_CATEGORY_SUB CS 
			ON CD.SUB_CODE = CS.SUB_CODE AND CD.MAIN_CODE = CS.MAIN_CODE
		<include refid="whereClause" />
		ORDER BY L.LECTURE_CODE DESC		
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}	
	</select>
	
	<select id="selectLectureListCnt" resultType="java.lang.Integer"> 
		SELECT
		    COUNT(L.LECTURE_CODE)            
		FROM ATOS_LECTURE L
		INNER JOIN ATOS_EDUCATION E 
			ON L.EDUCATION = E.EDU_CODE
		INNER JOIN ATOS_CATEGORY_DETAIL CD 
			ON E.CATEGORY = CD.CODE
		INNER JOIN ATOS_CATEGORY_MAIN CM 
			ON CD.MAIN_CODE = CM.MAIN_CODE
		INNER JOIN ATOS_CATEGORY_SUB CS 
			ON CD.SUB_CODE = CS.SUB_CODE AND CD.MAIN_CODE = CS.MAIN_CODE
		<include refid="whereClause" />
	</select>
	
<!-- 	<select id="selectStatusCode" resultType="atos.lms.member.service.MemberMasterVO">
		SELECT
			CODE AS statusCode, 
			NAME AS statusName
		FROM
			ATOS_STATUS
		WHERE CODE IN ('1001', '1002', '1003', '1004')
	</select>
	
	<select id="selectCompany" resultType="atos.lms.member.service.MemberMasterVO">
		SELECT
			BIZ_REG_NO AS corpBiz,
			CORP_NAME AS corpName
		FROM
			ATOS_COMPANY
	</select>

	<select id="selectMemberList" parameterType="atos.lms.member.service.MemberVO" resultType="atos.lms.member.service.MemberVO">
		SELECT
			A.ID, A.NAME, A.PHONE_NO, A.BIZ_REG_NO, A.STATUS, C.CORP_NAME, B.NAME AS listStatusName
		FROM
			ATOS_STUDENT A
		LEFT JOIN ATOS_STATUS B
			ON A.STATUS = B.CODE
		LEFT JOIN
			ATOS_COMPANY C
		ON A.BIZ_REG_NO = C.BIZ_REG_NO
		<include refid="whereClause" />
		ORDER BY A.ID DESC		
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>	
	
	<select id="selectMemberListCnt" parameterType="atos.lms.member.service.MemberVO" resultType="java.lang.Integer">
		SELECT
			COUNT(ID)
		FROM
			ATOS_STUDENT a
		<include refid="whereClause" />
	</select>
	
	<select id="selectCompanyKey" parameterType="String" resultType="atos.lms.member.service.CompanyVO">
		SELECT 
			BIZ_REG_NO, CORP_NAME, REP_NAME, BIZ_TYPE, BIZ_ITEM, PHONE_NO, ADDR1, ADDR2
		FROM
			ATOS_COMPANY
		WHERE BIZ_REG_NO = #{corpBiz}
	</select>
	
	<select id="selectMemberKey" parameterType="atos.lms.member.service.MemberVO" resultType="atos.lms.member.service.MemberDTO">
		SELECT 
			  A.ID, A.NAME, A.BIRTHDATE, A.PHONE_NO, A.EMAIL, A.ZIPCODE
			, A.ADDR1, A.ADDR2, A.BIZ_REG_NO, A.DEPARTMENT, A.POSITION
			, B.CORP_NAME, B.REP_NAME, B.BIZ_TYPE, B.BIZ_ITEM 
			, B.BIZ_REG_NO AS companybizRegNo
			, B.PHONE_NO AS companyPhoneNo
			, B.ZIPCODE AS companyZipcode
			, B.ADDR1 AS companyAddr1
			, B.ADDR2 AS companyAddr2
		FROM
			ATOS_STUDENT A 
		INNER JOIN 
			ATOS_COMPANY B
		ON A.BIZ_REG_NO = B.BIZ_REG_NO
		WHERE A.ID = #{id}
	</select>
	
	<select id="selectMemberListExcel" parameterType="atos.lms.member.service.MemberVO" resultType="atos.lms.member.service.MemberExcelVO">
		SELECT 
			  A.ID, A.NAME, A.BIRTHDATE, A.PHONE_NO, A.EMAIL, A.ZIPCODE
			, A.ADDR1, A.ADDR2, A.BIZ_REG_NO, A.DEPARTMENT, A.POSITION
			, B.CORP_NAME, B.REP_NAME, B.BIZ_TYPE, B.BIZ_ITEM 
			, B.BIZ_REG_NO AS companybizRegNo
			, B.PHONE_NO AS companyPhoneNo
			, B.ZIPCODE AS companyZipcode
			, B.ADDR1 AS companyAddr1
			, B.ADDR2 AS companyAddr2
		FROM
			ATOS_STUDENT A 
		left JOIN 
			ATOS_COMPANY B
		ON A.BIZ_REG_NO = B.BIZ_REG_NO
		<include refid="whereClause" />
	</select>
	
	<select id="checkEmailDuplicate" resultType="int">
	    SELECT COUNT(1)
	    FROM ATOS_STUDENT
	    WHERE ID = #{email}
	</select>
	
	<select id="checkDuplicateId" resultType="int">
		SELECT COUNT(1)
		FROM ATOS_STUDENT
		WHERE ID = #{id}
	</select>
	
	
	<update id="updateStatus">
		UPDATE ATOS_STUDENT
		SET STATUS = #{status}
		WHERE ID IN
		<foreach item="id" collection="idlist" open="(" separator="," close=")">
			#{id}
		</foreach>
	</update>
	

	<insert id="insertMember">
		INSERT INTO ATOS_STUDENT
			(ID, PASSWORD, NAME, BIRTHDATE, PHONE_NO, ZIPCODE, ADDR1, ADDR2, EMAIL, BIZ_REG_NO, STATUS, DEPARTMENT, POSITION)
		VALUES
			(#{id}, #{password}, #{name}, #{birthdate}, #{phoneNo}, #{zipcode}, #{addr1}, #{addr2}, #{email}, #{bizRegNo}, '1002', #{department}, #{position})
	</insert>
	
	<insert id="insertMemberList">
	    INSERT INTO ATOS_STUDENT 
	    	(ID, PASSWORD, NAME, BIRTHDATE, PHONE_NO, EMAIL, BIZ_REG_NO, STATUS, DEPARTMENT, POSITION)
	    VALUES
	    <foreach collection="memberList" item="member" separator=",">
	        (#{member.id}, #{member.password}, #{member.name}, #{member.birthdate}, #{member.phoneNo}, #{member.email}, #{member.bizRegNo}, #{member.status}, #{member.department}, #{member.position})
	    </foreach>
	</insert>
	
	<update id="updateMember">
		UPDATE ATOS_STUDENT
		SET 
			  NAME = #{name}
			, BIRTHDATE = #{birthdate}
			, PHONE_NO = #{phoneNo}
			, ZIPCODE = #{zipcode}
			, ADDR1 = #{addr1}
			, ADDR2 = #{addr2}
			, EMAIL = #{email}
			, BIZ_REG_NO = #{bizRegNo}
			, DEPARTMENT = #{department}
			, POSITION = #{position}
		WHERE ID = #{id}
	</update>
	
	<update id="deleteMember">
		UPDATE ATOS_STUDENT
		SET STATUS = '1005'
		WHERE ID = #{id}
	</update> -->

	
</mapper>